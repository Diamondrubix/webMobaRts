

<canvas id="canvas" width="900" height="500"></canvas>


<script type="text/javascript">
var vendors = ['webkit', 'moz'];
for (var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {
    window.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];
    window.cancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame'] || window[vendors[x] + 'CancelRequestAnimationFrame'];
}

var canvas = document.getElementById('canvas'),
    cw = canvas.width,
    ch = canvas.height,
    cx = null,
    fps = 60,
 
    lastTime = (new Date()).getTime(),
    currentTime = 0,
    delta = 0;
    x = 100
    y = 100

window.addEventListener('keydown',this.check,false);
window.addEventListener('keyup',this.uncheck,false);

keys = []

function gameLoop() {
    window.requestAnimationFrame(gameLoop);

    currentTime = (new Date()).getTime();
    delta = (currentTime - lastTime) / 1000;
    cx.clearRect(0, 0, cw, cw);

    
    draw();


    lastTime = currentTime;
}

class Obj {

	constructor(x,y,size,color) {
		this.x = x; 
	  	this.y = y;

	  	this.size = size;

	  	this.xVel = 0;
	  	this.yVel = 0;

	  	this.keys= false;

	  	this.locked="none"
	}

	getPoints(){
		return{
			l1: this.x,
			r1: this.x + this.size,
			l2: this.y,
			r2: this.y + this.size
		}
	}

	collide(r){
		this.happend = (this.x < r.x + r.size && this.x + this.size > r.x && this.y < r.y + r.size && this.y + this.size > r.y);


		var a = this;
		var b = r;

		var x = Math.max(a.x, b.x);
	  	var num1 = Math.min(a.x + a.size, b.x + b.size);
	  	var y = Math.max(a.y, b.y);
	  	var num2 = Math.min(a.y + a.size, b.y + b.size);
	  
/*
  if (num1 >= x && num2 >= y){
    return new Rectangle(x, y, num1 - x, num2 - y);
  }*/

		if(this.happend){
			 return {
				overlapX : num1 - x,
				overlapY: num2 - y,
				x: x,
				y: y
			}
		}else{
			return false;
		}

	}


	tick(){

  	if(this.keys){

  		if(keys.indexOf("d")!=-1 || keys.indexOf("a")!=-1 || keys.indexOf("w")!=-1 || keys.indexOf("s")!=-1){
  			if(this.xVel != 0){
  				this.lastX = this.xVel;
  			}
  			if(this.yVel != 0){
  				this.lastyY = this.yVel;
  			}
  		}
  	
	  	if(keys.indexOf("d")!=-1){
		  	this.xVel += 2;
		}

		if(keys.indexOf("a")!=-1){
		  	this.xVel -= 2;
		}


		if(keys.indexOf("w")!=-1){
		  	this.yVel -= 2;
		}

		if(keys.indexOf("s")!=-1){
		  	this.yVel += 2;
		}


		this.color = "red";



		
		this.x += this.xVel;

		for(var i=0; i<things.length;i++){
			if(things[i]!=this){
				this.collision = this.collide(things[i]);
				if(this.collision != false){
		
					this.color = "green";

					if(this.xVel > 0){
						things[i].x += this.collision.overlapX;
						this.x -= this.collision.overlapX

					}else if(this.xVel < 0){
						things[i].x -= this.collision.overlapX;
						this.x += this.collision.overlapX
					}
					

				}
			}
		}


		this.y += this.yVel;


		for(var i=0; i<things.length;i++){
			if(things[i]!=this){
				this.collision = this.collide(things[i]);
				if(this.collision != false){
					
					this.color = "green";
					
					if(this.yVel > 0){
						things[i].y += this.collision.overlapY;
						this.y -= this.collision.overlapY
					}else if(this.yVel < 0){
						things[i].y -= this.collision.overlapY;
						this.y += this.collision.overlapY
					}


				}
			}
		}



	}


  	

  	if(this.xVel>0){
  		this.xVel--;
  	}else if(this.xVel<0){
  		this.xVel++;
  	}

  	if(this.yVel>0){
  		this.yVel--;
  	}else if(this.yVel<0){
  		this.yVel++;
  	}

  	if(this.xVel > 10 ){
  		this.xVel = 10;
  	}else if (this.xVel < -10 ){
  		this.xVel = -10;
  	}

	if(this.yVel > 10 ){
  		this.yVel = 10;
  	}else if(this.yVel < -10 ){
  		this.yVel = -10;
  	}  	


  }

  paint(){


  	this.tick()

  	cx.beginPath();
  	cx.strokeStyle = this.color;
  	cx.rect(this.x,this.y,this.size,this.size);
  	cx.stroke();

	

  }


}



you = new Obj(100,100,50,"red");
you.keys = true;

wall = new Obj(200,200,100,"red");


things = [you,wall]


function draw(){


	for(var i=0; i < things.length; i++){
		things[i].paint();
	}




}




function uncheck(e) {
	index = keys.indexOf(e.key);
	if (index > -1) {
  		keys.splice(index, 1);
	}
}

function check(e) {

	index = keys.indexOf(e.key);
	if (index == -1) {
  		keys.push(e.key);
	}


    
}



if (typeof (canvas.getContext) !== undefined) {
    cx = canvas.getContext('2d');

    gameLoop();
}
</script>